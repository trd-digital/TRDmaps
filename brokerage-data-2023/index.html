<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Sample of BootStrap Table that render CSV file</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- bootstrap itself -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css"
        integrity="sha256-7ZWbZUAi97rkirk4DcEp4GWDPkWpRMcNaEyXGsNXjLg=" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha256-wMCQIK229gKxbUg3QWa544ypI4OoFlC2qQl8Q8xD8x8=" crossorigin="anonymous"></script>
    <!-- jquery needed for bootstrap-table-->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <!-- bootstrap-table-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-table@1.20.2/dist/bootstrap-table.min.css"
        integrity="sha256-LeU0tzGXsUojxMQgTdjRB74+q8RQhqUQoobY4+76cY8=" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-table@1.20.2/dist/bootstrap-table.min.js"
        integrity="sha256-lQSRQ2EUXUKg2xkKTV+D0E3rACEAi1aI+809LI5drdc=" crossorigin="anonymous"></script>

    <script>
        function responseHandlerCsvWithoutHeader(csvText) {
            // we should specify column names manually
            let headers = ['source_doc_id', 'recorded_date', 'doc_date', 'doc_amount', 'borough', 'addresses', 'units',
                'bbl',
                'new_dev_sale_type', 'property_group', 'property_type', 'neighborhood', 'Brokerage', 'link_url'
            ]

            return responseHandlerCsvToJsonHeaders(csvText, headers);
        }
    </script>
</head>
<table id="table" data-toggle="table" data-escape="true" data-response-handler="responseHandlerCsvToJson"
    data-data-type="text" data-url="data.csv">
    <thead>
        <tr>
            <th data-field="source_doc_id">Source ID</th>
            <th data-field="recorded_date">Recorded Data</th>
            <th data-field="doc_date">Document ID</th>
            <th data-field="doc_amount">Document Amount</th>
            <th data-field="borough">Borough</th>
            <th data-field="addresses">Addresses</th>
            <th data-field="source_doc_id">Source Document ID</th>
            <th data-field="recorded_date">Record ID</th>
            <th data-field="units">Units</th>
            <th data-field="bbl">BBL</th>
            <th data-field="new_dev_sale_type">Development Type</th>
            <th data-field="property_group">Proprty Group</th>
            <th data-field="property_type">Property Type</th>
            <th data-field="neighborhood">Neighborhood</th>
            <th data-field="Brokerage">Brokerage</th>
            <th data-field="link_url">Link</th>
        </tr>
    </thead>
</table>
</body>

</html>

<script>
    function responseHandlerCsvToJson(csvText) {
        let csvLines = csvText.split("\n")
        if (csvLines.length <= 1) {
            return {
                rows: []
            }
        }
        let headers = csvLines[0].split(",")
        return csvLinesToJsonRows(csvLines.slice(1), headers);
    }

    function responseHandlerCsvToJsonHeaders(csvText, headers) {
        let csvLines = csvText.split("\n")
        return csvLinesToJsonRows(csvLines, headers);
    }

    function csvLinesToJsonRows(csvLines, headers) {
        let jsonRows = []
        for (let csvLineIdx = 0; csvLineIdx < csvLines.length; csvLineIdx++) {
            let csvLine = csvLines[csvLineIdx]
            if (!csvLine) {
                continue
            }
            let fields = csvLine.split(",")
            let row = {}
            if (fields.length === 0) {
                continue
            }
            for (let headerIdx = 0; headerIdx < headers.length; headerIdx++) {
                let header = headers[headerIdx]
                if (fields.length > headerIdx) {
                    row[header] = fields[headerIdx]
                }
            }
            jsonRows[csvLineIdx] = row
        }
        return {
            rows: jsonRows
        }
    }
</script>